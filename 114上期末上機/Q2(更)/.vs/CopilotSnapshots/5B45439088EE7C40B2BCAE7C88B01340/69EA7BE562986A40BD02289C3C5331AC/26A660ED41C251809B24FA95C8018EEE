using System;
using System.Globalization;
using System.Windows.Forms;

namespace Q2_更_
{
    public partial class Form1 : Form
    {
        // Price constants
        private const decimal PRICE_OIL_CHANGE = 780m;
        private const decimal PRICE_LUBRICATION = 540m;
        private const decimal PRICE_RADIATOR = 900m;
        private const decimal PRICE_TRANSMISSION = 2400m;
        private const decimal PRICE_INSPECTION = 450m;
        private const decimal PRICE_MUFFLER = 3000m;
        private const decimal PRICE_TIRE_ROTATION = 600m;
        private const decimal LABOR_RATE = 600m; // per hour
        private const decimal PARTS_TAX_RATE = 0.06m; // 6%

        public Form1()
        {
            InitializeComponent();
            // Set default values
            textBoxParts.Text = "0";
            textBoxHours.Text = "0";
        }

        private void buttonCalculate_Click(object sender, EventArgs e)
        {
            try
            {
                // Parse and validate inputs from textboxes
                if (!decimal.TryParse(textBoxParts.Text.Trim(), NumberStyles.Number, CultureInfo.CurrentCulture, out decimal partsFee))
                {
                    MessageBox.Show("零件費用格式不正確，請輸入數字。", "輸入錯誤", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return;
                }

                if (!decimal.TryParse(textBoxHours.Text.Trim(), NumberStyles.Number, CultureInfo.CurrentCulture, out decimal hours))
                {
                    MessageBox.Show("工時格式不正確，請輸入數字。", "輸入錯誤", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return;
                }

                if (partsFee < 0)
                {
                    MessageBox.Show("請輸入非負的零件費用。", "輸入錯誤", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return;
                }

                if (hours < 0)
                {
                    MessageBox.Show("請輸入非負的工時。", "輸入錯誤", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    return;
                }

                // Calculate selected service fees
                decimal serviceFees = 0m;
                if (checkBoxOilChange.Checked) serviceFees += PRICE_OIL_CHANGE;
                if (checkBoxLubrication.Checked) serviceFees += PRICE_LUBRICATION;
                if (checkBoxRadiator.Checked) serviceFees += PRICE_RADIATOR;
                if (checkBoxTransmission.Checked) serviceFees += PRICE_TRANSMISSION;
                if (checkBoxInspection.Checked) serviceFees += PRICE_INSPECTION;
                if (checkBoxMuffler.Checked) serviceFees += PRICE_MUFFLER;
                if (checkBoxTireRotation.Checked) serviceFees += PRICE_TIRE_ROTATION;

                // Labor fee
                decimal laborFee = hours * LABOR_RATE;

                decimal serviceAndLaborTotal = serviceFees + laborFee;

                // Tax
                decimal tax = Math.Round(partsFee * PARTS_TAX_RATE, 2);

                decimal total = serviceAndLaborTotal + partsFee + tax;

                // Display with currency formatting (NT$)
                labelServiceFeeValue.Text = serviceAndLaborTotal.ToString("C0", CultureInfo.CurrentCulture);
                labelLaborFeeValue.Text = laborFee.ToString("C0", CultureInfo.CurrentCulture);
                labelPartsFeeValue.Text = partsFee.ToString("C0", CultureInfo.CurrentCulture);
                labelTaxValue.Text = tax.ToString("C0", CultureInfo.CurrentCulture);
                labelTotalValue.Text = total.ToString("C0", CultureInfo.CurrentCulture);
            }
            catch (Exception ex)
            {
                MessageBox.Show("計算時發生錯誤: " + ex.Message, "錯誤", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }

        private void buttonClear_Click(object sender, EventArgs e)
        {
            // Clear selections and inputs
            checkBoxOilChange.Checked = false;
            checkBoxLubrication.Checked = false;
            checkBoxRadiator.Checked = false;
            checkBoxTransmission.Checked = false;
            checkBoxInspection.Checked = false;
            checkBoxMuffler.Checked = false;
            checkBoxTireRotation.Checked = false;

            textBoxParts.Text = "0";
            textBoxHours.Text = "0";

            // Reset displays
            labelServiceFeeValue.Text = "NT$ 0";
            labelLaborFeeValue.Text = "NT$ 0";
            labelPartsFeeValue.Text = "NT$ 0";
            labelTaxValue.Text = "NT$ 0";
            labelTotalValue.Text = "NT$ 0";
        }
    }
}
